{% extends 'admin/base.html.twig' %}

{% block title %} Clients {% endblock %}


{% block body %}

<div class="pcoded-content">
	<div class="pcoded-inner-content">
		<div class="main-body">
			<div class="page-wrapper">
				<div class="page-body">
					{% for label, messages in app.flashes %}
						<div class="alert alert-{{ label }} background-{{ label }}">
							<button type="button" class="close" data-dismiss="alert" aria-label="Close">
								<i class="icofont icofont-close-line-circled text-white"></i>
							</button>
							{% for message in messages %}
								<p style="margin-bottom: 0px !important;">{{ message | raw }}</p>
							{% endfor %}
						</div>
					{% endfor %}
					<div class="card">
						<div class="card-header">
							<h5>Clients</h5>
						</div>
						<div class="card-block table-border-style">
							{% if customers %}
								<div class="table-responsive">
									<table class="table table-striped table-bordered datatable display">
										<thead>
											<tr>
												<th>Prénom</th>
												<th>Nom</th>
												<th>Email</th>
												<th>Adresse</th>
												<th>Téléphone</th>
												<th>Nb commandes</th>
												<th>Commandes</th>
												<th>Montant total</th>
											</tr>
										</thead>
										<tbody>
											{% for customer in customers %}
												<tr>
													<td>{{ customer.firstname|capitalize }}</td>
													<td>{{ customer.lastname|capitalize }}</td>
													<td>{{ customer.email }}</td>
													<td>{{ customer.address }}</td>
													<td>{{ customer.phone }}</td>
													<td>{{ customer.orders|length }}</td>
													<td>
														{% set amount = 0 %}
														{% for order in customer.orders %}
															{% set amount = amount + order.total %}
															<a href="{{ path('admin_order_edit', { id: order.id }) }}" style="color: #007bff;" target="_blank">
																N°{{ order.id }}
															</a>
															{% if not loop.last %}, {% endif %}
														{% endfor %}
													</td>
													<td>{{ amount|number_format(2, ',', ' ') }}€</td>
												</tr>
											{% endfor %}
										</tbody>
									</table>
								</div>
							{% else %}
								Il n'y a pas de clients
							{% endif %}
						</div>
					</div>
				</div>
			</div>
		</div>
		<div id="styleSelector"></div>
	</div>
</div>
</div>
</div>


{% endblock %}


{% block javascripts %}

{% include 'admin/partials/datatable.html.twig' %}
{% endblock %}
