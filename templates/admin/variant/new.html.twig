{% extends 'admin/base.html.twig' %}

{% block title %}Ajouter un variant{% endblock %}

{% form_theme form 'admin/variant/_form_theme.html.twig' %}

{% block body %}

<div class="pcoded-content">
  <div class="pcoded-inner-content">
    <div class="main-body">
      <div class="page-wrapper">
        <div class="page-body">
          {% for label, messages in app.flashes %}
            <div class="alert alert-{{ label }} background-{{ label }}">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <i class="icofont icofont-close-line-circled text-white"></i>
              </button>
              {% for message in messages %}
                  <p style="margin-bottom: 0px !important;">{{ message | raw }}</p>
              {% endfor %}
            </div>
          {% endfor %}
          <div class="card">
            <div class="card-header">
              <h5>Ajouter un variant</h5>
            </div>
            <div class="card-block">
              {{ form_start(form) }}
              {{ form_row(form.title, { 'label': 'Titre' }) }}
              <hr>
              {{ form_row(form.priceLists, { 'label': 'Ajouter une ou plusieurs grilles' }) }}
              <div class="form-group row mt-2" style="float: right; margin-right: 20px;">
                <button type="submit" class="btn btn-primary m-b-0">Ajouter un variant</button>
              </div>
              {{ form_end(form) }}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="styleSelector">
    </div>
  </div>
</div>
</div>
</div>


{% endblock %}


{% block javascripts %}

<script>
// Ad Form Config Array Collection
$('#addPriceList').click(function(){
    const prices = $('#admin_variant_priceLists');
    const widgetsCounter = $('#widgets-counter');
    const index = +widgetsCounter.val();
    const template = prices.data('prototype').replace(/__name__/g, index);
    widgetsCounter.val(index + 1);
    prices.append(template);
    handleDeleteButtons();
});

function handleDeleteButtons() {
    $('button[data-action="delete"]').click(function(){
        const target = this.dataset.target;
        $(target).remove();
    });
}

function updateCounter() {
    const widgetsCounter = $('#widgets-counter');
    const count = +$('#admin_variant_priceLists div.form-group').length;
    widgetsCounter.val(count);
}

updateCounter();
handleDeleteButtons();
</script>


{% endblock %}
